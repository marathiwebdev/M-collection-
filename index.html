<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MCollections ‚Äî Farmer Panel</title>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDAPIylSFOKGA6Tpu8kmn2otF4L0SpQh6g",
    authDomain: "mcollections-22e3f.firebaseapp.com",
    databaseURL: "https://mcollections-22e3f-default-rtdb.firebaseio.com",
    projectId: "mcollections-22e3f",
    storageBucket: "mcollections-22e3f.firebasestorage.app",
    messagingSenderId: "798498490029",
    appId: "1:798498490029:web:86db83ee562a2d2f12e824",
    measurementId: "G-5LEYGZJQCY"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  window.showRecords = async function(){
    const farmerId = document.getElementById("farmerId").value.trim();
    const msg = document.getElementById("msg");
    const recordsDiv = document.getElementById("records");
    recordsDiv.innerHTML = "";

    if (!farmerId) {
      msg.innerText = "‡§ï‡•É‡§™‡§Ø‡§æ ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§Ü‡§Ø‡§°‡•Ä ‡§≠‡§∞‡§æ.";
      return;
    }

    msg.innerText = "‡§∞‡•á‡§ï‡•â‡§∞‡•ç‡§° ‡§Æ‡§ø‡§≥‡§µ‡§§ ‡§Ü‡§π‡•á...";

    try {
      const snapshot = await get(child(ref(db), `farmers/${farmerId}/records`));
      if (snapshot.exists()) {
        msg.innerText = "";
        const data = snapshot.val();
        for (const [date, entry] of Object.entries(data)) {
          recordsDiv.innerHTML += `
            <div class="card">
              <h4>${date}</h4>
              <p>üåû ‡§∏‡§ï‡§æ‡§≥: ${entry.morning.litres} ‡§≤‡§ø √ó ‚Çπ${entry.morning.rate} = ‚Çπ${entry.morning.total}</p>
              <p>üåô ‡§∞‡§æ‡§§‡•ç‡§∞: ${entry.night.litres} ‡§≤‡§ø √ó ‚Çπ${entry.night.rate} = ‚Çπ${entry.night.total}</p>
              <strong>‡§è‡§ï‡•Ç‡§£: ‚Çπ${entry.totalAmount}</strong>
            </div>
          `;
        }
      } else {
        msg.innerText = "‡§∞‡•á‡§ï‡•â‡§∞‡•ç‡§° ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§æ‡§π‡•Ä‡§§.";
      }
    } catch (e) {
      msg.innerText = "‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä: " + e.message;
      console.error(e);
    }
  };
</script>

<style>
  body { font-family:'Noto Sans Devanagari',sans-serif; background:#f2f2f2; }
  .box { max-width:450px; margin:40px auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
  h2 { text-align:center; color:#006400; }
  input,button { width:100%; padding:10px; margin:6px 0; font-size:16px; border-radius:6px; border:1px solid #ccc; }
  button { background:#006400; color:#fff; border:none; cursor:pointer; }
  button:hover { background:#004d00; }
  #records .card { background:#f9f9f9; padding:10px; margin:8px 0; border-radius:6px; border:1px solid #ddd; }
  #msg { text-align:center; color:#333; }
</style>
</head>
<body>
  <div class="box">
    <h2>‡§¶‡•Ç‡§ß ‡§∏‡§Ç‡§ï‡§≤‡§® ‚Äî Farmer Panel</h2>
    <input type="text" id="farmerId" placeholder="‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§Ü‡§Ø‡§°‡•Ä (‡§â‡§¶‡§æ. 45)">
    <button onclick="showRecords()">‡§∞‡•á‡§ï‡•â‡§∞‡•ç‡§° ‡§™‡§π‡§æ</button>
    <p id="msg"></p>
    <div id="records"></div>
  </div>
</body>
</html>
